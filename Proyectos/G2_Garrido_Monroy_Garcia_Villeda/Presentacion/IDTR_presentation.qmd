---
title: "Proyecto 2"
editor: visual
theme: dracula
format:
    revealjs:
        slide-number: c/t     # opciones: true | c/t | h/v | h/v/c
        progress: true
        css: mi_estilo.css
---

## 

![](Imagenes/1.png){width="300"}

## 

![](Imagenes/2.png){width="300"}

## 

![](Imagenes/3.png){width="300"}

## 

![](Imagenes/BID.png){width="300"}

## 

![](Imagenes/4.png){width="300"}

## 

![](Imagenes/5.png){width="300"}

## 

![](Imagenes/Flujo.jpg){width="300"}

## 

![](Imagenes/6.png){width="300"}

## 

![](Imagenes/7.png){width="300"}

## 

![](Imagenes/ENCOVI.png){width="300"}

## 

![](Imagenes/8.png){width="300"}

## 

![](Imagenes/9.png){width="300"}

## 

![](Imagenes/nueva_11_y_12.png){width="300"}

## 

![](Imagenes/indicadores_1.png){width="300"}

## 

![](Imagenes/indicadores_2.png){width="300"}

## 

![](Imagenes/14.png){width="300"}

## Normalización de los datos

Formula utilizada para la normalización:

$$
x_i^{*}=\frac{x_i-\min(x)}{\max(x)-\min(x)}
$$

```{r eval = FALSE}
#| echo: true
#America Latina y el Caribe
params <- tibble::tribble(
    ~variable,                 ~better,    ~floor_F,   ~target_T,
    "var_uso_intern",               "higher",   13.8,        77,
    "var_uso_intern_mujeres",       "higher",   4.87,        72,
    "var_uso_acceso_tel_mov",       "higher",   30.85,       83.4,
    "pct_rural",                    "lower",    83.54,        18.2,
    "propor_hogares_internet",      "higher",   2.79,        66.2,
    "propor_hogares_computadora",   "higher",   3.44,        42.91,
    "rb_por_100k",                  "higher",   36,          200,
    "lineas_por_1k",                "higher",   8.4,         404.9,
    "pib_per_capita",                "higher",   1168.69,     14654.9
)

```

## Cálculo de indicadores {.center}

con las bases de datos depuradas, se procedió a calcular los indicadores de conectividad por departamento

::: {.table-scroll-400 .table-compact}
```{r message=FALSE, warning=FALSE}
library(readxl)
library(knitr)
library(tidyverse)
# library(dplyr)
df_indicadores <- read_xlsx("../output/indicadores_acceso_tecnologico_2.xlsx")
df_indicadores$depto <- recode(
    df_indicadores$depto, 
    "1" = "Guatemala",
    "2" = "El Progreso",
    "3" = "Sacatepequez",
    "4" = "Chimaltenango",
    "5" = "Escuintla",
    "6" = "Santa Rosa",
    "7" = "Solola",
    "8" = "Totonicapan",
    "9" = "Quetzaltenango",
    "10" = "Suchitepequez",
    "11" = "Retalhuleu",
    "12" = "San Marcos",
    "13" = "Huehuetenango",
    "14" = "Quiche",
    "15" = "Baja Verapaz",
    "16" = "Alta Verapaz",
    "17" = "Petén",
    "18" = "Izabal",
    "19" = "Zacapa",
    "20" = "Chiquimula",
    "21" = "Jalapa",
    "22" = "Jutiapa"
)


knitr::kable(df_indicadores, format = "html")
```
:::

## Análisis de resultados

![](Imagenes/plot_incidencia_por_depto.JPEG)

## Análisis de resultados {.smaller}

:::: {.columns}
::: {.column width="50%"}
![](Imagenes/mejor_vs_peor.jpeg)
:::

::: {.column width="50%"}
![](Imagenes/gt_mapa_best.png)
:::
::::

## Análisis de resultados


```{r warning=FALSE, message=FALSE}
library(tidyverse)
library(scales)
library(gt)

rm(list=ls())
cat("\014")
graphics.off()


df_idx <- read_xlsx("../output/idx.xlsx")

df_idx <- df_idx |>
    mutate( depto = recode(
        depto,
        `1`  = "Guatemala",
        `2`  = "El Progreso",
        `3`  = "Sacatepéquez",
        `4`  = "Chimaltenango",
        `5`  = "Escuintla",
        `6`  = "Santa Rosa",
        `7`  = "Sololá",
        `8`  = "Totonicapán",
        `9`  = "Quetzaltenango",
        `10` = "Suchitepéquez",
        `11` = "Retalhuleu",
        `12` = "San Marcos",
        `13` = "Huehuetenango",
        `14` = "Quiché",
        `15` = "Baja Verapaz",
        `16` = "Alta Verapaz",
        `17` = "Petén",
        `18` = "Izabal",
        `19` = "Zacapa",
        `20` = "Chiquimula",
        `21` = "Jalapa",
        `22` = "Jutiapa"
    )
)


# -------- 1) Identificar Mejor y Peor por suma total --------


ponderadores <- c(0.18,0.10,0.1,0.12,0.15,0.10,0.10,0.05,0.10)
df_idx <- df_idx |>
    mutate(
        across(2:10, ~ .x * ponderadores[cur_column() == names(df_idx)[-1]])
    )


cols_vars <- setdiff(names(df_idx), "depto")

df_tot <- df_idx |>
    mutate(total = rowSums(across(all_of(cols_vars)), na.rm = TRUE))


best  <- df_tot |> slice_max(total, n = 1, with_ties = FALSE) |> pull(depto)
worst <- df_tot |> slice_min(total, n = 1, with_ties = FALSE) |> pull(depto)

# Etiquetas de variables
labels_vars <- c(
    var_uso_intern               = "Uso internet (total)",
    var_uso_intern_mujeres       = "Uso internet (mujeres)",
    var_uso_acceso_tel_mov       = "Acceso tel. móvil",
    pct_rural                    = "% urbanización (o 1-% rural)",
    propor_hogares_internet      = "Hogares con internet",
    propor_hogares_computadora   = "Hogares con computadora",
    rb_por_100k                  = "Redes/antenas por 100k",
    lineas_por_1k                = "Líneas por 1k",
    pib_per_capita               = "PIB per cápita (norm.)"
)

df_best_worst <- df_idx |>
    filter(depto %in% c(best, worst)) 

tab <- df_best_worst %>%
    pivot_longer(-depto, names_to = "indicador", values_to = "valor") %>%
    mutate(indicador = recode(indicador, !!!labels_vars)) %>%
    group_by(indicador) %>%
    summarise(
        Mejor        = max(valor, na.rm = TRUE),
        Peor         = min(valor, na.rm = TRUE),
        `Brecha abs.`= abs(Mejor - Peor),
        .groups = "drop"
    ) %>%
    arrange(desc(`Brecha abs.`))

gt(tab) %>%
    tab_header(title = md("**Brecha relativa: Mejor vs Peor**")) %>%
    cols_label(indicador = "Indicador") %>%
    cols_align(columns = indicador, align = "left") %>%
    cols_align(columns = c(Mejor, Peor, `Brecha abs.`), align = "center") %>%
    fmt_percent(columns = c(Mejor, Peor, `Brecha abs.`),
                decimals = 1, scale_values = FALSE) %>%
    tab_options(table.width = pct(100))


```


## librería gt {.centers}

Es una librería para generar tablas visuales de alta calidad para usar en presentaciones y es mantenido por posit.

<https://gt.rstudio.com/index.html>

## 

![](Imagenes/Conclusiones.png){width="300"}

## Fin

![](Imagenes/15.png){width="300"}
